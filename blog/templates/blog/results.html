<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <title>æ¨¡å‹çµæœå±•ç¤ºé é¢</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="d-flex flex-column min-vh-100">
    {% include "blog/_navbar.html" %}
    <div class="container">
        <br>
        <!-- ğŸ“Œ é é¢æ¨™é¡Œ -->
        <h2 class="mb-4 text-center">ğŸ“Š æ¨¡å‹è¨“ç·´èˆ‡æ¸¬è©¦çµæœé é¢</h2>

        <!-- ğŸ” æ­·å²ç´€éŒ„å€å¡Šï¼šæœªä¾†å¾è³‡æ–™åº«å‚³å…¥ -->
        <h3 class="mt-5">ğŸ”¥ ç†±åƒåœ–æ—¥æœŸé¸æ“‡</h3>
        <div id="heatmap-folder-buttons" class="text-center mb-4"></div>

        <h3 class="mt-5">ğŸ“ˆ è¨“ç·´æ›²ç·šæ—¥æœŸé¸æ“‡</h3>
        <div id="trainplot-folder-buttons" class="text-center mb-4"></div>

        <h3>ğŸ”¥ ç†±åƒåœ–</h3>
        <div id="heatmap-container" class="row"></div>

        <h3 class="mt-5">ğŸ“ˆ è¨“ç·´æ›²ç·š</h3>
        <div id="trainplot-container" class="row"></div>

        <!-- ğŸ”™ è¿”å›é¦–é æŒ‰éˆ• -->
        <div class="text-center mt-4">
            <a href="/" class="btn btn-secondary btn-lg">ğŸ”™ è¿”å›é¦–é </a>
        </div>
    </div>
    <script>
        const socket = new WebSocket("ws://" + window.location.host + "/ws/CMD/");
        
        socket.onmessage = function(event) {
            const data = JSON.parse(event.data);
            console.log(data);

            if (data.type === 'media_folders') {
                const heatmapContainer = document.getElementById('heatmap-folder-buttons');
                const trainplotContainer = document.getElementById('trainplot-folder-buttons');
                heatmapContainer.innerHTML = '';
                trainplotContainer.innerHTML = '';

                data.folders.forEach(folder => {
                    // ç†±åƒåœ–æŒ‰éˆ•
                    const heatBtn = document.createElement('button');
                    heatBtn.textContent = folder.date;
                    heatBtn.className = "btn btn-outline-danger m-2";
                    heatBtn.onclick = () => {
                        socket.send(JSON.stringify({
                            action: 'list-heatmap-files',
                            folder: folder.date
                        }));
                    };
                    heatmapContainer.appendChild(heatBtn);

                    // è¨“ç·´åœ–æŒ‰éˆ•
                    const trainBtn = document.createElement('button');
                    trainBtn.textContent = folder.date;
                    trainBtn.className = "btn btn-outline-primary m-2";
                    trainBtn.onclick = () => loadTrainplots(folder.trainplot_url);
                    trainplotContainer.appendChild(trainBtn);
                });
            }
            else if (data.type === 'heatmap_files') {
                console.log("ğŸ“¥ æ¥æ”¶åˆ° heatmap_files", data);
                const heatmapContainer = document.getElementById('heatmap-container');
                heatmapContainer.innerHTML = '';

                const folder = data.folder;
                const files = data.files;

                files.forEach(filename => {
                    const img = document.createElement('img');
                    img.src = `/static/heatmaps/${folder}/AN_L/${filename}`;
                    img.className = "img-fluid col-md-4 p-2";
                    heatmapContainer.appendChild(img);
                });
            }
        };


        function loadTrainplots(trainplotUrl) {
            const trainplotContainer = document.getElementById('trainplot-container');
            trainplotContainer.innerHTML = '';
            ['loss.png', 'acc.png'].forEach(file => {
                const img = document.createElement('img');
                img.src = trainplotUrl + file;
                img.className = "img-fluid col-md-6 p-2";
                trainplotContainer.appendChild(img);
            });
        }
        
        // ğŸ‘‰ ä¸€é€²ä¾†å°±è«‹æ±‚æ‰€æœ‰è³‡æ–™å¤¾
        socket.onopen = () => {
            socket.send(JSON.stringify({ action: "list-results" }));
        };
    </script>
</body>
</html>
